###1.什么是TCP连接的三次握手?为什么需要三次而不是两次?四次握手关闭连接？
- 第一次握手：客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认；
- 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；
- 第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。
握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，
TCP 连接都将被一直保持下去。断开连接时服务器和客户端均可以主动发起断开TCP连接的请求，断开过程需要经过“四次握手”（过程就不细写了，就是服务器和客户端
交互，最终确定断开） 
- TCP的三次握手最主要是防止已过期的连接再次传到被连接的主机。如果采用两次的话，会出现下面这种情况。
> 比如是A机要连到B机，结果发送的连接信息由于某种原因没有到达B机；于是，A机又发了一次，结果这次B收到了，于是就发信息回来，两机就连接。传完东西后，断开。
三次握手改成仅需要两次握手，可能发生死锁。
考虑计算机A和B之间的通信，假定B给A发送一个连接请求分组，A收到了这个分组，并发送了确认应答分组。按照两次握手的协定，A认为连接已经成功地建立了，可以开始
发送数据分组。可是，B在A的应答分组在传输中被丢失的情况下，将不知道A是否已准备好，不知道A建议什么样的序列号，B甚至怀疑A是否收到自己的连接请求分组。在这
种情况下，B认为连接还未建立成功，将忽略A发来的任何数据分组，只等待连接确认应答分组。而A在发出的分组超时后，重复发送同样的分组。这样就形成了死锁。
还可能造成响应端资源浪费。如果是两次：C发送请求，S应答并分配资源，若S的应答没有到达C端，C认为连接未建立，而S认为建立了，S会在一段时间内保留分配的资源
如果大量C这样请求，S会崩溃。 

![Alt text](http://upload-images.jianshu.io/upload_images/1171077-0aa5c47288de6a23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

四次握手关闭连接,这个过程可以用以下四句形象的对话表示：<br />
（客户端）：我要关闭连接了。<br />
（服务端）：你那边的连接可以关闭了。<br />
（服务端）：我这边也要关闭连接了。<br />
（客户端）：你那边的连接可以关闭了。<br />
由于连接是双向的，所以双方都要主动关闭自己这一侧的连接。<br />
关闭连接的最后一个 ACK 丢失怎么办?<br />
实际上，在第三步中，客户端收到 FIN 包时，它会设置一个计时器，等待相当长的一段时间。如果客户端返回的 ACK 丢失，那么服务端还会重发 FIN 并重置计时器。假设在计时器失效前服务器重发的 FIN 包没有到达客户端，客户端就会进入 CLOSE 状态，从而导致服务端永远无法收到 ACK 确认，也就无法关闭连接。示意图如下：

![Alt text](http://upload-images.jianshu.io/upload_images/1171077-26891821458de42c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


参考原文:[http://www.jianshu.com/p/dc456cf57e06](http://www.jianshu.com/p/dc456cf57e06)


###2.OSI七层模型和协议?
- 物理层:主要任务是将比特流与电子信号进行转换。
- 数据链路层:定义了通过通信介质相互连接的设备之间，数据传输的规范。意义在于，如果没有数据链路层，数据只能以流的形式存在与通信介质中，不知道该发送往哪里，过
长的数据流可能无法在通信介质中传输。作用在于实现同一种数据链路下的包传递。
- 网络层:主要作用是实现终端节点间的通信。相比于数据链路层，网络层实现跨越不同数据链路的包传递。网络层中还有ARP(获取MAC地址)和ICMP协议(数据发送异常通知)
- 传输层:传输层位于 OSI 七层模型的第四层（由下往上）。顾名思义，传输层的主要作用是实现应用程序之间的通信。网络层主要是保证不同数据链路下数据的可达性，至于如何传输数据则是由传输层负责。常见的传输层协议主要有 TCP 协议和 UDP 协议。
- 会话层
- 表示层
- 应用层

###3.五类不同的IP地址?
- A类:0+7位网络号+24位主机号       范围:0.0.0.0 到 127.255.255.255 可容纳的主机为2^24-2
- B类:10+14位网络号+16位主机号     范围:127.0.0.0 到 191.255.255.255 可容纳的主机数为2^16-2
- C类:110+21位网络号+8位主机号     范围:192.0.0.0 到 223.255.255.255 可容纳的主机数为2^8 - 2
- D类:1110+14位网络号+28位多播组号 范围:224.0.0.0 到 239.255.255.255
- E类:11110+27位留待后用          范围:240.0.0.0 到 247.255.255.255
- 有三类IP地址:单播地址(目的为单个主机)、广播地址(目的端为给定网络上的所有主机)以及多播地址(目的端为同一组内的所有主机)
- 子网掩码：是一个 32 bit的值,其中值为 1的比特留给网络号和子网号,为0的比特留给主机号。

###4.ARP是什么协议?它的作用？
ARP 协议(Address Resolution Protocol)用于通过目标 IP 地址，定位下一个接收数据包的网络设备的 MAC 地址。如果目标主机处在同一个数据链路上，那么可以直接得到目标主机的 MAC 地址，否则会得到下一条路由器的 MAC 地址。
ARP 协议的工作原理可以分为两部分：ARP 请求和 ARP 响应。 首先，源主机会通过广播发送一个 ARP 请求包：“我要与 IP 地址为 xxx 的主机通话，谁知道它的 MAC地址？”。
数据链路上的所有主机都会收到这条消息并检查自己的 IP 地址，如果与 ARP 请求包中的 IP 地址一致，主机就会发送 ARP 响应包：“我就是 IP 地址为 xxx 的主机，我的 MAC 地址是：xxxx”。
下图表示了 ARP 协议的工作机制：<br />
![Alt text](http://upload-images.jianshu.io/upload_images/1171077-51bfbcfa875295d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 =500x300)

ARP机制:在实际的使用过程中，每次往目标主机发送数据都要使用 ARP 是很低效的，通常的做法是把获取到的 MAC 地址缓存一段时间。一般来说，一旦源主机向目标地址发送一个数据包，接下来继续发送多次的概率非常大，因此这种缓存非常容易命中。
当下一次发送 ARP 请求或超过一定时间后，缓存都会失效，这保证了即使 MAC 地址与 IP 地址的对应关系发生了变化，数据包依然能够被正确的发往目标地址。再次强调一下，MAC 和 IP 地址虽然看上去功能类似(都是用于唯一区分主机)，但是两者缺一不可。如果只有 IP 地址，虽然可以跳过 ARP，直接在数据链路上发一个广播，但是这仅适用于通信双方处于同一个数据链路下的情况。如果双方处于不同的数据链路，数据报无法穿透中间的路由器。如果全世界只用 MAC 地址，那么请参考交换机的自学过程，可以想象这个过程会带来庞大的，不必要的流量。正因为 MAC 和 IP 地址缺一不可，所以才产生了 ARP 这样的协议将两者关联起来。

执行命令:ftp bsdi会进行以下这些步骤：- 应用程序FTP客户端调用函数gethostbyname(3)把主机名(bsdi)转换成32bit的IP地址。这个函数在DNS(域名系统)中称作解析器,我们将在第14章对它进行介绍。
这个转换过程或者使用DNS,或者在较小网络中使用一个静态的主机文件(/etc/hosts)。- FTP客户端请求TCP用得到的IP地址建立连接。- TCP发送一个连接请求分段到远端的主机,即用上述IP地址发送一份IP数据报(在第18章我们将讨论完成这个过程的细节)。- 如果目的主机在本地网络上(如以太网、令牌环网或点对点链接的另一端),那么IP数据报可以直接送到目的主机上。如果目的主机在一个远程网络上,那么就通过IP选路
函数来确定位于本地网络上的下一站路由器地址,并让它转发IP数据报。在这两种情况下,IP数据报都是被送到位于本地网络上的一台主机或路器。- 假定是一个以太网,那么发送端主机必须把32bit的IP地址变换成48bit的以太网地址。从逻辑Internet地址到对应的物理硬件地址需要进行翻译。这就是ARP的功能。
ARP本来是用于广播网络的,有许多主机或路由器连在同一个网络上。- ARP发送一份称作ARP请求的以太网数据帧给以太网上的每个主机。这个过程称作广播,如图4-2中的虚线所示。ARP请求数据帧中包含目的主机的IP地址(主机名为bsdi),
其意思是“如果你是这个IP地址的拥有者,请回答你的硬件地址。”
- 目的主机的ARP层收到这份广播报文后,识别出这是发送端在寻问它的IP地址,于是发送一个ARP应答。这个ARP应答包含IP地址及对应的硬件地址。- 收到ARP应答后,使ARP进行请求—应答交换的IP数据报现在就可以传送了。- 发送IP数据报到目的主机。
![Alt text](http://images.cnitblog.com/blog/516074/201308/23233332-abc3735cd1a24ef3a9a6d8c2d62ea4b0.png)



###5.DNS解析?作用?
IP地址用于识别通信双方的地址，但它是一串长数字，不方便记忆，人们希望主机有自己自己的名字，这个名字是唯一的，而且容易记住。于是，诞生了“域名”的概念。域名是一种为了识别主机名称和机构名的具有分层的名称，比如在域名 neu.edu.cn中，neu是主机名，edu 和 cn 是不同层次下的机构名。域名和 IP 地址都可以唯一对应一台主机，DNS 协议的作用就是将自身具有意义的域名转换成不容易记住的 IP 地址。域名是分层的，每层都有自己的 DNS 服务器用于处理 DNS 解析的请求。这样的好处在于每层的服务器不用关注过多的信息，它只要知道自己这一层下的域名服务器信息即可。以解析域名： www.ietf.org为例：根服务器其实并不知道 www.ietf.org 的 IP 地址，但是它知道 itef.org 域名服务器的地址，所以它把这条查询请求转发给 itef.org 域名服务器。DNS请求被逐层下发，直到找到对应的 IP 地址为止。
![Alt http://upload-images.jianshu.io/upload_images/1171077-51bfbcfa875295d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240text](http://upload-images.jianshu.io/upload_images/1171077-fee307f330da613b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 =500x450)<br />
参考:[http://www.jianshu.com/p/f0d5a8ee9f17](http://www.jianshu.com/p/f0d5a8ee9f17)
###6.NAT 和 NAPT 技术?
NAT (Network Address Translator) 是一种用于将局域网中的私有地址转换成全局 IP 地址的技术。
在连接上无线路由器的时候，如果检查一下设备的 IP 地址，也许你会发现是类似于 192.168.1.1 这样的局域网 IP 地址。那不同网段中，IP 地址都是 192.168.1.1 的主机改如何通信呢？
下图描绘了 NAT 的工作原理：
局域网中 IP 地址为 10.0.0.10 的主机向全局 IP 地址 163.221.120.9 发送数据。NAT 路由器将数据包的源地址修改成自己的全局 IP 地址：202.244.174.37。同理，接收数据时，路由器把目标地址 202.244.174.37 翻译成内网地址：10.0.0.10。NAT工作原理:
![Alt text](http://upload-images.jianshu.io/upload_images/1171077-e8540d2e539e72c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 =500x300)<br />
路由器只有一个对外的全局 IP 地址，如果有多个内网主机都向外部通讯怎么办呢？这时就要使用 NAPT 技术，它和 NAT 从原理上类似，但它可以转换 TCP 和 UDP 端口号。
使用 NAPT 技术时，不同的内网 IP 被转换成同一个公共 IP 地址，也就是路由器对外显示的全局 IP 地址，但是被附加不同的端口号以示区分：
<br />
![Alt text](http://upload-images.jianshu.io/upload_images/1171077-7f9ad0357a5ba4d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 =500x450)<br />
NAPT工作原理
不管是 NAT 还是 NAPT，都需要路由器路由器内部维护一张自动生成的地址转换表。以 TCP 为例，建立 TCP 连接首次握手的 SYN 包发出时会生成这个表，关闭连接时会发出 FIN 包，收到这个包的应答时转换表被删除。
原文链接：[http://www.jianshu.com/p/f0d5a8ee9f17](http://www.jianshu.com/p/f0d5a8ee9f17)
###7.socket连接和http连接的区别？https?
- HTTP协议：简单对象访问协议，对应于应用层 ，HTTP协议是基于TCP连接的
- TCP/IP是传输层协议，主要解决数据如何在网络中传输；而HTTP是应用层协议，主要解决如何包装数据。
- Socket：是对TCP/IP协议的封装，Socket本身并不是协议，而是一个调用接口（API），通过Socket，我们才能使用TCP/IP协议。
- http连接：http连接就是所谓的短连接，即客户端向服务器端发送一次请求，服务器端响应后连接即会断掉；
- socket连接：socket连接就是所谓的长连接，理论上客户端和服务器端一旦建立起连接将不会主动断掉；但是由于各种环境因素可能会是连接断开，比如说：服务器端或客户端主机down了，网络故障，或者两者之间长时间没有数据传输，网络防火墙可能会断开该连接以释放网络资源。所以当一个socket连接中没有数据的传输，那么为了维持连接需要发送心跳消息~~具体心跳消息格式是开发者自己定义的。> HTTPS（Hypertext Transfer Protocol over Secure Socket Layer，基于SSL的HTTP协议）使用了HTTP协议，但HTTPS使用不同于HTTP协议的默认端口及一个加密、身份验证层（HTTP与TCP之间）。这个协议的最初研发由网景公司进行，提供了身份验证与加密通信方法，现在它被广泛用于互联网上安全敏感的通信。

- 客户端在使用HTTPS方式与Web服务器通信时有以下几个步骤，如图所示。<br />
（1）客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。<br />
（2）Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。<br />
（3）客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级。<br />
（4）客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。<br />
（5）Web服务器利用自己的私钥解密出会话密钥。<br />
（6）Web服务器利用会话密钥加密与客户端之间的通信。<br />
![Alt text](http://pic002.cnblogs.com/images/2012/339704/2012071410212142.gif)<br />
[参考](http://blog.csdn.net/mingli198611/article/details/8055261/)

###8.POST 请求和 GET 请求？
> HTTP 有八种请求（也称方法），其中最常见的是 GET 请求和 POST 请求。

- GET请求通常用于查询、获取数据，而 POST 请求则用于发送数据，除了用途上的区别，它们还有以下这些不同：
- GET请求可以被缓存，可以被收藏为书签，但 POST 不行。
- GET请求会保留在浏览器的历史记录中，POST 不会。
- GET请求的长度有限制（不同的浏览器不一样，大约在几 Kb 左右），URL 的数据类型只能是 ASCII 字符，POST 请求没有限制。
- GET请求的参数在 URL 中，因此绝不能用 GET 请求传输敏感数据。POST 请求数据则写在 HTTP 的请求头中，安全性略高于 GET 请求。
原文链接：[http://www.jianshu.com/p/6e7521041e92](http://www.jianshu.com/p/6e7521041e92)

###9.Cookie 和 Session?
> HTTP 是一种无状态的连接，客户端每次读取 web 页面时，服务器都会认为这是一次新的会话。但有时候我们又需要持久保持某些信息，比如登录时的用户名、密码，用户上一次连接时的信息等。这些信息就由 Cookie 和 Session 保存。

这两者的根本性区别在于，cookie 保存在客户端上，而 session 则保存在服务器中。由此我们还可以拓展出以下结论：

1. cookie 相对来说不安全，浏览器可以分析本地的 cookie 进行 cookie 欺骗。
2. session 可以设置超时时间，超过这个时间后就失效，以免长期占用服务端内存。
3. 单个 cookie 的大小有限制（4 Kb），每个站点的 cookie 数量一般也有限制（20个）。
4. 客户端每次都会把 cookie 发送到服务端，因此服务端可以知道 cookie，但是客户端不知道 session。

当服务器接收到 cookie 后，会根据 cookie 中的 SessionID 来找到这个客户的 session。如果没有，则会生成一个新的 SessionID 发送给客户端。


###6.文件断点续传的原理?
> 断点续传其实正如字面意思，就是在下载的断开点继续开始传输，不用再从头开始。所以理解断点续传的核心后，发现其实和很简单，关键就在于对传输中断点的把握。

原理：
断点续传的关键是断点，所以在制定传输协议的时候要设计好，如下图，我自定义了一个交互协议，每次下载请求都会带上下载的起始点，这样就可以支持从断点下载了，其实HTTP里的断点续传也是这个原理，在HTTP的头里有个可选的字段RANGE，表示下载的范围，

![Alt text](http://img.blog.csdn.net/20141206215834127?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemhhb3dlbjI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center =500x500)[参考](http://blog.csdn.net/zdy0_2004/article/details/41814651)
